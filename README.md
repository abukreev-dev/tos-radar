# tos-radar

Скрипт для ежедневного мониторинга изменений в ToS-документах сервисов.

## Быстрый старт

1. Создать файлы конфигурации:
- `cp .env.example .env`
- `cp config/tos_urls.txt.example config/tos_urls.txt`
- `cp config/proxies.txt.example config/proxies.txt`
2. Заполнить `config/tos_urls.txt` реальными URL ToS (по одному на строку).
3. При необходимости заполнить `config/proxies.txt`.
4. Первый сбор baseline:
- `make init`
5. Ежедневный запуск проверки:
- `make run`

## Make-команды

- `make init` — первый сбор baseline.
- `make run` — сравнение с baseline и генерация отчета.
- `make test` — unit-тесты.
- `make lint` — статический линтинг.
- `make report-open` — открыть последний HTML-отчет.

## Планируемые фичи

### MVP

- Запуск раз в сутки по cron.
- Входные файлы:
- `config/tos_urls.txt` (по одному URL в строке, 1 домен = 1 URL, дубли домена — ошибка конфигурации).
- `config/proxies.txt` (`host:port` или `host:port:login:pass`).
- Стек: `Python 3.12 + Playwright`.
- Обработка только “чистого текста” (без HTML-разметки, ссылок, меню/футеров по эвристике).
- Поддержка PDF-документов по прямому URL.
- Политика попыток:
- сначала без прокси;
- при неуспехе до 3 попыток с разными прокси;
- таймаут 60 секунд на URL;
- при полном неуспехе статус `FAILED`, пайплайн продолжается.
- Параллелизм по умолчанию: `20` (через конфиг).
- Нормализация текста: lowercase, схлопывание пробелов/переносов, удаление пунктуации.
- Сравнение с предыдущей версией и статусы: `CHANGED / UNCHANGED / FAILED`.
- Для первого наполнения — отдельный запуск `make init` (baseline).
- При `CHANGED` — обновление baseline на новую версию.
- Для `FAILED` baseline не изменяется.
- Хранение на диске только 2 последних версий (`current + previous`).
- Общий HTML-отчет за запуск (не отдельные файлы по сервисам), с подсвеченным diff.
- Логи в файл `logs/run-YYYYMMDD-HHMMSS.log` и в консоль.
- Таймзона в логах/отчете: локальная серверная.
- Make-команды: `make init`, `make run`, `make test`, `make lint`, `make report-open`.
- Unit-тесты: нормализация, сравнение, парсинг конфигов, ротация попыток.

### Полный релиз

- UI/интерфейс с аккаунтами пользователей.
- Пользовательский выбор подключенных сервисов для мониторинга.
- Добавление собственных URL пользователем через интерфейс.
- Автопоиск ToS на сайте (вместо только фиксированных URL).
- Переход от “страницы-агрегатора” к актуальному документу (поиск последней версии договора).
- Расширенные каналы уведомлений (например, Telegram/email/webhook).
- База данных для долгосрочной истории и аналитики.
- Гибкие правила очистки контента (site-specific правила поверх общей эвристики).
- Интеграционные тесты с реальными источниками.

## Детальный контекст

Полный зафиксированный контекст обсуждения: `docs/context.md`.
